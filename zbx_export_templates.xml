<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>5.4</version>
    <date>2021-11-30T08:02:19Z</date>
    <groups>
        <group>
            <uuid>846977d1dfed4968bc5f8bdb363285bc</uuid>
            <name>Templates/Operating systems</name>
        </group>
        <group>
            <uuid>02e4df4f20b848e79267641790f241da</uuid>
            <name>Templates/Virtualization</name>
        </group>
    </groups>
    <templates>
        <template>
            <uuid>0cdda41cd7fa4af6ace3dfa42ac68858</uuid>
            <template>Proxmox VE by HTTP</template>
            <name>Proxmox VE by HTTP</name>
            <description>Proxmox VE Template - queries VM and NODE statuses by HTTP API</description>
            <groups>
                <group>
                    <name>Templates/Operating systems</name>
                </group>
                <group>
                    <name>Templates/Virtualization</name>
                </group>
            </groups>
            <discovery_rules>
                <discovery_rule>
                    <uuid>efb9aa937b1745a5b58535c8094bfb60</uuid>
                    <name>PVE API Cluster</name>
                    <type>HTTP_AGENT</type>
                    <key>pve.cluster</key>
                    <delay>10m</delay>
                    <description>PVE - Status of cluster nodes</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>ebacb528631c44a8be1bc673d6ee210a</uuid>
                            <name>PVE Node {#NODE} memory free</name>
                            <type>DEPENDENT</type>
                            <key>pve.nodes.memory.free[{#NODE}]</key>
                            <delay>0</delay>
                            <units>b</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.memory.free</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.nodes[{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <uuid>9c05783b524a481f97333822f88dfcf8</uuid>
                            <name>PVE Node {#NODE} memory size</name>
                            <type>DEPENDENT</type>
                            <key>pve.nodes.memory.total[{#NODE}]</key>
                            <delay>0</delay>
                            <units>b</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.memory.total</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.nodes[{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <uuid>29de93ddc7d3471f891040586b842a74</uuid>
                            <name>PVE Node {#NODE} memory used</name>
                            <type>DEPENDENT</type>
                            <key>pve.nodes.memory.used[{#NODE}]</key>
                            <delay>0</delay>
                            <units>b</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.memory.used</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.nodes[{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <uuid>3dfe850deaa845aea78d782ef2e5e315</uuid>
                            <name>PVE Node {#NODE} pveversion</name>
                            <type>DEPENDENT</type>
                            <key>pve.nodes.pveversion[{#NODE}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.pveversion</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.nodes[{#NODE}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>93f819244a234f4d8f0f60609d707fd7</uuid>
                                    <expression>change(/Proxmox VE by HTTP/pve.nodes.pveversion[{#NODE}])&gt;0</expression>
                                    <name>PVE Node {#NODE} pve version changed</name>
                                    <priority>INFO</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>887c6dea4edb42b79934a20e37b8dbbe</uuid>
                            <name>PVE Node {#NODE} rootfs available</name>
                            <type>DEPENDENT</type>
                            <key>pve.nodes.rootfs.avail[{#NODE}]</key>
                            <delay>0</delay>
                            <units>b</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.rootfs.avail</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.nodes[{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <uuid>af68d89173924335adb0bc7196b83be2</uuid>
                            <name>PVE Node {#NODE} rootfs free</name>
                            <type>DEPENDENT</type>
                            <key>pve.nodes.rootfs.free[{#NODE}]</key>
                            <delay>0</delay>
                            <units>b</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.rootfs.free</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.nodes[{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <uuid>66acbbb17e27484d8b95cb99271e9266</uuid>
                            <name>PVE Node {#NODE} rootfs size</name>
                            <type>DEPENDENT</type>
                            <key>pve.nodes.rootfs.total[{#NODE}]</key>
                            <delay>0</delay>
                            <units>b</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.rootfs.total</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.nodes[{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <uuid>adec78a34d3844d39f21936d28e72c42</uuid>
                            <name>PVE Node {#NODE} rootfs used</name>
                            <type>DEPENDENT</type>
                            <key>pve.nodes.rootfs.used[{#NODE}]</key>
                            <delay>0</delay>
                            <units>b</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.rootfs.used</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.nodes[{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <uuid>42fe812ad87e4626a83688813ef4d32c</uuid>
                            <name>PVE Node {#NODE} swap free</name>
                            <type>DEPENDENT</type>
                            <key>pve.nodes.swap.free[{#NODE}]</key>
                            <delay>0</delay>
                            <units>b</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.swap.free</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.nodes[{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <uuid>cd8ff86593124472901491e077969459</uuid>
                            <name>PVE Node {#NODE} swap size</name>
                            <type>DEPENDENT</type>
                            <key>pve.nodes.swap.total[{#NODE}]</key>
                            <delay>0</delay>
                            <units>b</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.swap.total</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.nodes[{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <uuid>e7c14a61616a47009c65cfcf3ee03fbc</uuid>
                            <name>PVE Node {#NODE} swap used</name>
                            <type>DEPENDENT</type>
                            <key>pve.nodes.swap.used[{#NODE}]</key>
                            <delay>0</delay>
                            <units>b</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.swap.used</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.nodes[{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <uuid>1b1c0014023d4f0ea4a84dfc2a9ea411</uuid>
                            <name>PVE Node {#NODE} uptime</name>
                            <type>DEPENDENT</type>
                            <key>pve.nodes.uptime[{#NODE}]</key>
                            <delay>0</delay>
                            <units>s</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.uptime</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.nodes[{#NODE}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>ee8bba82c10c4577a98b54b4e7b94026</uuid>
                                    <expression>last(/Proxmox VE by HTTP/pve.nodes.uptime[{#NODE}])&lt;600</expression>
                                    <name>PVE Node {#NODE} uptime lesser than 10m</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>7d3677c5173c4a95b45a1de691f15edf</uuid>
                            <name>PVE Node {#NODE} status</name>
                            <type>HTTP_AGENT</type>
                            <key>pve.nodes[{#NODE}]</key>
                            <history>1d</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>PVE Node status</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.data</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <url>https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/status/</url>
                            <headers>
                                <header>
                                    <name>Authorization</name>
                                    <value>PVEAPIToken={$PVE_API_TOKEN}</value>
                                </header>
                            </headers>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>ff9575608e4a44079f7443c20e7387a8</uuid>
                            <name>PVE Node {#NODE} memory</name>
                            <graph_items>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Proxmox VE by HTTP</host>
                                        <key>pve.nodes.memory.total[{#NODE}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <drawtype>FILLED_REGION</drawtype>
                                    <color>F63100</color>
                                    <item>
                                        <host>Proxmox VE by HTTP</host>
                                        <key>pve.nodes.memory.used[{#NODE}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <uuid>583d774e1d5c486085b4a7e46ac0d89b</uuid>
                            <name>PVE Node {#NODE} rootfs</name>
                            <graph_items>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Proxmox VE by HTTP</host>
                                        <key>pve.nodes.rootfs.total[{#NODE}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <drawtype>FILLED_REGION</drawtype>
                                    <color>F63100</color>
                                    <item>
                                        <host>Proxmox VE by HTTP</host>
                                        <key>pve.nodes.rootfs.used[{#NODE}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <uuid>52e555a97e1c4bfba6e54b468a62ecc3</uuid>
                            <name>PVE Node {#NODE} swap</name>
                            <graph_items>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Proxmox VE by HTTP</host>
                                        <key>pve.nodes.swap.total[{#NODE}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <drawtype>FILLED_REGION</drawtype>
                                    <color>F63100</color>
                                    <item>
                                        <host>Proxmox VE by HTTP</host>
                                        <key>pve.nodes.swap.used[{#NODE}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <url>https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/cluster/status/</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVE_API_TOKEN}</value>
                        </header>
                    </headers>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#NODE}</lld_macro>
                            <path>$.['name']</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#IP}</lld_macro>
                            <path>$.['ip']</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.data</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>9d08d64e298340b08ec08bd694980421</uuid>
                    <name>PVE API Resources - qemu</name>
                    <type>HTTP_AGENT</type>
                    <key>pve.cluster.resources.qemu</key>
                    <delay>10m</delay>
                    <filter>
                        <conditions>
                            <condition>
                                <macro>{#TYPE}</macro>
                                <value>^qemu$</value>
                                <formulaid>A</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <description>PVE - Status of cluster resources - qemu</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>004ca8fbe58e45d781e27262ea92f449</uuid>
                            <name>PVE Vm {#VMID} - {#NAME} cpu usage</name>
                            <type>DEPENDENT</type>
                            <key>pve.vm.cpu[{#VMID}]</key>
                            <delay>0</delay>
                            <value_type>FLOAT</value_type>
                            <units>%</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.cpu</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <parameters>
                                        <parameter>100</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.vm[{#VMID}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>fd6b87ea220b4a828f01d5bf9c6cb617</uuid>
                                    <expression>last(/Proxmox VE by HTTP/pve.vm.cpu[{#VMID}])&gt;80</expression>
                                    <name>PVE Vm {#VMID} - {#NAME} high CPU usage</name>
                                    <priority>WARNING</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>31aeb70e1522428bad9a30a512bd7eee</uuid>
                            <name>PVE Vm {#VMID} - {#NAME} status</name>
                            <type>DEPENDENT</type>
                            <key>pve.vm.status[{#VMID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.status</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.vm[{#VMID}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>3f3c7104e2bd4031b01ef0876d4a3b8b</uuid>
                                    <expression>find(/Proxmox VE by HTTP/pve.vm.status[{#VMID}],,,&quot;running&quot;)=0</expression>
                                    <name>PVE Vm {#VMID} - {#NAME} is not running</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>a32890cceec246b78668057d4368d594</uuid>
                            <name>PVE Vm {#VMID} - {#NAME} uptime</name>
                            <type>DEPENDENT</type>
                            <key>pve.vm.uptime[{#VMID}]</key>
                            <delay>0</delay>
                            <units>s</units>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.uptime</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pve.vm[{#VMID}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>938089eccf3a43ab87a42eed38ed507f</uuid>
                                    <expression>last(/Proxmox VE by HTTP/pve.vm.uptime[{#VMID}])&lt;600</expression>
                                    <name>PVE Vm {#VMID} - {#NAME} uptime &lt; 10m</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                    <dependencies>
                                        <dependency>
                                            <name>PVE Vm {#VMID} - {#NAME} is not running</name>
                                            <expression>find(/Proxmox VE by HTTP/pve.vm.status[{#VMID}],,,&quot;running&quot;)=0</expression>
                                        </dependency>
                                    </dependencies>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>9e8d7c7b4440438086876cfc9b94de9c</uuid>
                            <name>PVE Vm {#VMID} - {#NAME}</name>
                            <type>HTTP_AGENT</type>
                            <key>pve.vm[{#VMID}]</key>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.data</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <timeout>10s</timeout>
                            <url>https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/qemu/{#VMID}/status/current</url>
                            <headers>
                                <header>
                                    <name>Authorization</name>
                                    <value>PVEAPIToken={$PVE_API_TOKEN}</value>
                                </header>
                            </headers>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>2c3409a576c8455eb72e17bae1326268</uuid>
                            <name>PVE Vm {#VMID} - {#NAME} CPU usage</name>
                            <graph_items>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Proxmox VE by HTTP</host>
                                        <key>pve.vm.cpu[{#VMID}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <url>https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/cluster/resources/</url>
                    <headers>
                        <header>
                            <name>Authorization</name>
                            <value>PVEAPIToken={$PVE_API_TOKEN}</value>
                        </header>
                    </headers>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#NODE}</lld_macro>
                            <path>$.['node']</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#TYPE}</lld_macro>
                            <path>$.['type']</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#VMID}</lld_macro>
                            <path>$.['vmid']</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#NAME}</lld_macro>
                            <path>$.['name']</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.data</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <macros>
                <macro>
                    <macro>{$PVE_API_HOST}</macro>
                    <value>{HOST.NAME}</value>
                    <description>PVE web address. Default: {HOST.NAME}</description>
                </macro>
                <macro>
                    <macro>{$PVE_API_PORT}</macro>
                    <value>8006</value>
                    <description>PVE web UI port. Default: 8006</description>
                </macro>
                <macro>
                    <macro>{$PVE_API_TOKEN}</macro>
                    <type>SECRET_TEXT</type>
                    <description>PVE API Token. Example: root@pam!monitoring=69ab8098-f2aa-455c-add3-e387aef0a47e</description>
                </macro>
            </macros>
        </template>
    </templates>
</zabbix_export>
