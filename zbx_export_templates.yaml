zabbix_export:
  version: '5.4'
  date: '2021-11-30T07:03:03Z'
  groups:
    -
      uuid: 846977d1dfed4968bc5f8bdb363285bc
      name: 'Templates/Operating systems'
    -
      uuid: 02e4df4f20b848e79267641790f241da
      name: Templates/Virtualization
  templates:
    -
      uuid: 0cdda41cd7fa4af6ace3dfa42ac68858
      template: 'Proxmox VE by HTTP'
      name: 'Proxmox VE by HTTP'
      description: 'Proxmox VE Template - queries VM and NODE statuses by HTTP API'
      groups:
        -
          name: 'Templates/Operating systems'
        -
          name: Templates/Virtualization
      discovery_rules:
        -
          uuid: efb9aa937b1745a5b58535c8094bfb60
          name: 'PVE API Cluster'
          type: HTTP_AGENT
          key: pve.cluster
          delay: 10m
          description: 'PVE - Status of cluster nodes'
          item_prototypes:
            -
              uuid: ebacb528631c44a8be1bc673d6ee210a
              name: 'PVE Node {#NODE} memory free'
              type: DEPENDENT
              key: 'pve.nodes.memory.free[{#NODE}]'
              delay: '0'
              units: b
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.memory.free
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: 9c05783b524a481f97333822f88dfcf8
              name: 'PVE Node {#NODE} memory size'
              type: DEPENDENT
              key: 'pve.nodes.memory.total[{#NODE}]'
              delay: '0'
              units: b
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.memory.total
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: 29de93ddc7d3471f891040586b842a74
              name: 'PVE Node {#NODE} memory used'
              type: DEPENDENT
              key: 'pve.nodes.memory.used[{#NODE}]'
              delay: '0'
              units: b
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.memory.used
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: 3dfe850deaa845aea78d782ef2e5e315
              name: 'PVE Node {#NODE} pveversion'
              type: DEPENDENT
              key: 'pve.nodes.pveversion[{#NODE}]'
              delay: '0'
              trends: '0'
              value_type: TEXT
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.pveversion
              master_item:
                key: 'pve.nodes[{#NODE}]'
              trigger_prototypes:
                -
                  uuid: 93f819244a234f4d8f0f60609d707fd7
                  expression: 'change(/Proxmox VE by HTTP/pve.nodes.pveversion[{#NODE}])>0'
                  name: 'PVE Node {#NODE} pve version changed'
                  priority: INFO
                  manual_close: 'YES'
            -
              uuid: 887c6dea4edb42b79934a20e37b8dbbe
              name: 'PVE Node {#NODE} rootfs available'
              type: DEPENDENT
              key: 'pve.nodes.rootfs.avail[{#NODE}]'
              delay: '0'
              units: b
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.rootfs.avail
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: af68d89173924335adb0bc7196b83be2
              name: 'PVE Node {#NODE} rootfs free'
              type: DEPENDENT
              key: 'pve.nodes.rootfs.free[{#NODE}]'
              delay: '0'
              units: b
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.rootfs.free
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: 66acbbb17e27484d8b95cb99271e9266
              name: 'PVE Node {#NODE} rootfs size'
              type: DEPENDENT
              key: 'pve.nodes.rootfs.total[{#NODE}]'
              delay: '0'
              units: b
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.rootfs.total
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: adec78a34d3844d39f21936d28e72c42
              name: 'PVE Node {#NODE} rootfs used'
              type: DEPENDENT
              key: 'pve.nodes.rootfs.used[{#NODE}]'
              delay: '0'
              units: b
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.rootfs.used
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: 42fe812ad87e4626a83688813ef4d32c
              name: 'PVE Node {#NODE} swap free'
              type: DEPENDENT
              key: 'pve.nodes.swap.free[{#NODE}]'
              delay: '0'
              units: b
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.swap.free
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: cd8ff86593124472901491e077969459
              name: 'PVE Node {#NODE} swap size'
              type: DEPENDENT
              key: 'pve.nodes.swap.total[{#NODE}]'
              delay: '0'
              units: b
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.swap.total
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: e7c14a61616a47009c65cfcf3ee03fbc
              name: 'PVE Node {#NODE} swap used'
              type: DEPENDENT
              key: 'pve.nodes.swap.used[{#NODE}]'
              delay: '0'
              units: b
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.swap.used
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: 1b1c0014023d4f0ea4a84dfc2a9ea411
              name: 'PVE Node {#NODE} uptime'
              type: DEPENDENT
              key: 'pve.nodes.uptime[{#NODE}]'
              delay: '0'
              units: s
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.uptime
              master_item:
                key: 'pve.nodes[{#NODE}]'
              trigger_prototypes:
                -
                  uuid: ee8bba82c10c4577a98b54b4e7b94026
                  expression: 'last(/Proxmox VE by HTTP/pve.nodes.uptime[{#NODE}])<600'
                  name: 'PVE Node {#NODE} uptime lesser than 10m'
                  priority: WARNING
                  manual_close: 'YES'
            -
              uuid: 7d3677c5173c4a95b45a1de691f15edf
              name: 'PVE Node {#NODE} status'
              type: HTTP_AGENT
              key: 'pve.nodes[{#NODE}]'
              history: 1d
              trends: '0'
              value_type: TEXT
              description: 'PVE Node status'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.data
              url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/status/'
              headers:
                -
                  name: Authorization
                  value: 'PVEAPIToken={$PVE_API_TOKEN}'
          graph_prototypes:
            -
              uuid: ff9575608e4a44079f7443c20e7387a8
              name: 'PVE Node {#NODE} memory'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.memory.total[{#NODE}]'
                -
                  sortorder: '2'
                  drawtype: FILLED_REGION
                  color: F63100
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.memory.used[{#NODE}]'
            -
              uuid: 583d774e1d5c486085b4a7e46ac0d89b
              name: 'PVE Node {#NODE} rootfs'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.rootfs.total[{#NODE}]'
                -
                  sortorder: '2'
                  drawtype: FILLED_REGION
                  color: F63100
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.rootfs.used[{#NODE}]'
            -
              uuid: 52e555a97e1c4bfba6e54b468a62ecc3
              name: 'PVE Node {#NODE} swap'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.swap.total[{#NODE}]'
                -
                  sortorder: '2'
                  drawtype: FILLED_REGION
                  color: F63100
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.swap.used[{#NODE}]'
          url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/cluster/status/'
          headers:
            -
              name: Authorization
              value: 'PVEAPIToken={$PVE_API_TOKEN}'
          lld_macro_paths:
            -
              lld_macro: '{#NODE}'
              path: '$.[''name'']'
            -
              lld_macro: '{#IP}'
              path: '$.[''ip'']'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.data
        -
          uuid: 9d08d64e298340b08ec08bd694980421
          name: 'PVE API Resources - qemu'
          type: HTTP_AGENT
          key: pve.cluster.resources.qemu
          delay: 10m
          filter:
            conditions:
              -
                macro: '{#TYPE}'
                value: ^qemu$
                formulaid: A
          description: 'PVE - Status of cluster resources - qemu'
          item_prototypes:
            -
              uuid: 004ca8fbe58e45d781e27262ea92f449
              name: 'PVE Vm {#VMID} - {#NAME} cpu usage'
              type: DEPENDENT
              key: 'pve.vm.cpu[{#VMID}]'
              delay: '0'
              value_type: FLOAT
              units: '%'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.cpu
                -
                  type: MULTIPLIER
                  parameters:
                    - '100'
              master_item:
                key: 'pve.vm[{#VMID}]'
              trigger_prototypes:
                -
                  uuid: fd6b87ea220b4a828f01d5bf9c6cb617
                  expression: 'last(/Proxmox VE by HTTP/pve.vm.cpu[{#VMID}])>80'
                  name: 'PVE Vm {#VMID} - {#NAME} high CPU usage'
                  priority: WARNING
            -
              uuid: 31aeb70e1522428bad9a30a512bd7eee
              name: 'PVE Vm {#VMID} - {#NAME} status'
              type: DEPENDENT
              key: 'pve.vm.status[{#VMID}]'
              delay: '0'
              trends: '0'
              value_type: TEXT
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.status
              master_item:
                key: 'pve.vm[{#VMID}]'
              trigger_prototypes:
                -
                  uuid: 3f3c7104e2bd4031b01ef0876d4a3b8b
                  expression: 'find(/Proxmox VE by HTTP/pve.vm.status[{#VMID}],,,"running")=0'
                  name: 'PVE Vm {#VMID} - {#NAME} is not running'
                  priority: WARNING
                  manual_close: 'YES'
            -
              uuid: a32890cceec246b78668057d4368d594
              name: 'PVE Vm {#VMID} - {#NAME} uptime'
              type: DEPENDENT
              key: 'pve.vm.uptime[{#VMID}]'
              delay: '0'
              units: s
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.uptime
              master_item:
                key: 'pve.vm[{#VMID}]'
              trigger_prototypes:
                -
                  uuid: 938089eccf3a43ab87a42eed38ed507f
                  expression: 'last(/Proxmox VE by HTTP/pve.vm.uptime[{#VMID}])<600'
                  name: 'PVE Vm {#VMID} - {#NAME} uptime < 10m'
                  priority: WARNING
                  manual_close: 'YES'
                  dependencies:
                    -
                      name: 'PVE Vm {#VMID} - {#NAME} is not running'
                      expression: 'find(/Proxmox VE by HTTP/pve.vm.status[{#VMID}],,,"running")=0'
            -
              uuid: 9e8d7c7b4440438086876cfc9b94de9c
              name: 'PVE Vm {#VMID} - {#NAME}'
              type: HTTP_AGENT
              key: 'pve.vm[{#VMID}]'
              trends: '0'
              value_type: TEXT
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.data
              timeout: 10s
              url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/qemu/{#VMID}/status/current'
              headers:
                -
                  name: Authorization
                  value: 'PVEAPIToken={$PVE_API_TOKEN}'
          graph_prototypes:
            -
              uuid: 2c3409a576c8455eb72e17bae1326268
              name: 'PVE Vm {#VMID} - {#NAME} CPU usage'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.vm.cpu[{#VMID}]'
          url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/cluster/resources/'
          headers:
            -
              name: Authorization
              value: 'PVEAPIToken={$PVE_API_TOKEN}'
          lld_macro_paths:
            -
              lld_macro: '{#NODE}'
              path: '$.[''node'']'
            -
              lld_macro: '{#TYPE}'
              path: '$.[''type'']'
            -
              lld_macro: '{#VMID}'
              path: '$.[''vmid'']'
            -
              lld_macro: '{#NAME}'
              path: '$.[''name'']'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.data
      macros:
        -
          macro: '{$PVE_API_HOST}'
          value: '{HOST.NAME}'
          description: 'PVE web address. Default: {HOST.NAME}'
        -
          macro: '{$PVE_API_PORT}'
          value: '8006'
          description: 'PVE web UI port. Default: 8006'
        -
          macro: '{$PVE_API_TOKEN}'
          type: SECRET_TEXT
          description: 'PVE API Token. Example: root@pam!monitoring=69ab8098-f2aa-455c-add3-e387aef0a47e'
