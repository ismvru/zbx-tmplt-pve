zabbix_export:
  version: '5.4'
  date: '2021-12-13T09:11:30Z'
  groups:
    -
      uuid: f2481361f99448eea617b7b1d4765566
      name: 'Discovered hosts'
    -
      uuid: 846977d1dfed4968bc5f8bdb363285bc
      name: 'Templates/Operating systems'
    -
      uuid: 02e4df4f20b848e79267641790f241da
      name: Templates/Virtualization
  templates:
    -
      uuid: 0cdda41cd7fa4af6ace3dfa42ac68858
      template: 'Proxmox VE by HTTP'
      name: 'Proxmox VE by HTTP'
      description: |
        # Proxmox VE by HTTP
        
        Monitors PVE VMs and nodes by PVE HTTP API
        
        Tested on Zabbix 5.4.7 and PVE 7.1
        
        ## Usage
        
        - Go to PVE WEB UI -> Datacenter -> Api Tokens
        - Click "Add"
        - Select User (usualy - `root@pam`)
        - Enter Token ID (for example - `monitoring`)
        - **Uncheck "Privelege separation"**
        - Click "Add"
        
        You will see "Token ID" (example - `root@pam!monitoring`) and "Secret" (some UUID). Save "Secret" value, because you can't display it again!
        
        - Import template into Zabbix
        - Attach template to any server you want, and fill macroses (described below)
        
        ## Macroses
        
        | Macro              | Description        | Example                                                    |
        | ------------------ | ------------------ | ---------------------------------------------------------- |
        | `{$PVE_API_HOST}`  | PVE web UI address | `pve.example.org`                                          |
        | `{$PVE_API_PORT}`  | PVE web UI Port    | `8006`                                                     |
        | `{$PVE_API_TOKEN}` | PVE API Token      | `root@pam!monitoring=69ab8098-f2aa-455c-add3-e387aef0a47e` |
      groups:
        -
          name: 'Templates/Operating systems'
        -
          name: Templates/Virtualization
      items:
        -
          uuid: 2421ff30528f425e852e014a6c7a5f16
          name: 'PVE API Cluster resources'
          type: HTTP_AGENT
          key: pve.cluster.resources
          delay: 10m
          history: 1d
          trends: '0'
          value_type: TEXT
          description: 'Gets `https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/cluster/resources/`  for autodiscovery'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.data
          url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/cluster/resources/'
          headers:
            -
              name: Authorization
              value: 'PVEAPIToken={$PVE_API_TOKEN}'
        -
          uuid: 486b8ae9eb2048378c6e660fd1a70fcc
          name: 'PVE API Cluster status'
          type: HTTP_AGENT
          key: pve.cluster.status
          history: 1d
          trends: '0'
          value_type: TEXT
          description: 'Gets `https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/cluster/status/` for autodiscovery'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.data
          url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/cluster/status/'
          headers:
            -
              name: Authorization
              value: 'PVEAPIToken={$PVE_API_TOKEN}'
        -
          uuid: 54e414d89698418c81a2725e57e38aff
          name: 'PVE API Log warnings'
          type: HTTP_AGENT
          key: pve.log
          delay: 10m
          history: 1d
          trends: '0'
          value_type: LOG
          description: 'JSON Response for `https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/cluster/resources/` HTTP Query, filtered by pri < 4'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.data
            -
              type: JSONPATH
              parameters:
                - '$.[?(@.pri < 4)]'
          timeout: 30s
          url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/cluster/log'
          headers:
            -
              name: Authorization
              value: 'PVEAPIToken={$PVE_API_TOKEN}'
        -
          uuid: 62f5f27b04b447ec959322bbf506bc18
          name: 'PVE Log - Warnings - Last'
          type: DEPENDENT
          key: pve.log.last
          delay: '0'
          history: 1d
          trends: '0'
          value_type: LOG
          description: 'Last warning JSON in logs'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - '$.[0]'
          master_item:
            key: pve.log
        -
          uuid: f9b4ef0ccb284ee0832e9ae56b71bf62
          name: 'PVE Log - Warnings - Last message'
          type: DEPENDENT
          key: pve.log.last.message
          delay: '0'
          history: 10d
          trends: '0'
          value_type: TEXT
          description: 'Last warning message in logs'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.msg
          master_item:
            key: pve.log.last
        -
          uuid: 1e7d3849985649d1a2eac487d6462ceb
          name: 'PVE Log - Warnings - Last time'
          type: DEPENDENT
          key: pve.log.last.time
          delay: '0'
          history: 10d
          trends: '0'
          units: unixtime
          description: 'Time of last warning message in logs'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.time
          master_item:
            key: pve.log.last
      discovery_rules:
        -
          uuid: ba98e126ff8b4d0abab76f79e919ef60
          name: 'PVE API Resources - cluster'
          type: DEPENDENT
          key: pve.cluster
          delay: '0'
          filter:
            conditions:
              -
                macro: '{#TYPE}'
                value: ^cluster$
                formulaid: A
          description: 'Filter pve.cluster.resources and creates items, triggers and graphs'
          item_prototypes:
            -
              uuid: 93fbb53121c94aaf9d5f12992ca40bf3
              name: 'PVE Cluster {#NAME} nodes'
              type: DEPENDENT
              key: 'pve.cluster.nodes[{#NAME}]'
              delay: '0'
              description: 'Cluster node count'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.quorate
              master_item:
                key: 'pve.cluster[{#NAME}]'
              trigger_prototypes:
                -
                  uuid: 9c3deb4ca07a49b6b6e36a2a8d0e79c4
                  expression: 'change(/Proxmox VE by HTTP/pve.cluster.nodes[{#NAME}])<>0'
                  name: 'PVE Cluster {#NAME} node count changed'
                  priority: INFO
                  description: 'Node count was changed since last check'
            -
              uuid: 3894e8d1e0884a1c81ad718f6f071e3e
              name: 'PVE Cluster {#NAME} quorum'
              type: DEPENDENT
              key: 'pve.cluster.quorum[{#NAME}]'
              delay: '0'
              description: 'If 1 - Cluster in quorum'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.quorate
              master_item:
                key: 'pve.cluster[{#NAME}]'
              trigger_prototypes:
                -
                  uuid: 03f19be0d2b44ae2b6331cb34459aa8b
                  expression: 'last(/Proxmox VE by HTTP/pve.cluster.quorum[{#NAME}])<>1'
                  name: 'PVE Cluster {#NAME} not in quorum'
                  priority: HIGH
                  description: 'Cluster not in quorum'
            -
              uuid: 4377ac71105c45e78e5fe96da47834b9
              name: 'PVE Cluster {#NAME} status'
              type: HTTP_AGENT
              key: 'pve.cluster[{#NAME}]'
              history: 1d
              trends: '0'
              value_type: TEXT
              description: 'JSON Response for `https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/cluster/resources/` HTTP Query'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.data.[?(@.name == ''{#NAME}'')].first()'
              timeout: 10s
              url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/cluster/status/'
              headers:
                -
                  name: Authorization
                  value: 'PVEAPIToken={$PVE_API_TOKEN}'
          master_item:
            key: pve.cluster.resources
          lld_macro_paths:
            -
              lld_macro: '{#NAME}'
              path: '$.[''name'']'
            -
              lld_macro: '{#TYPE}'
              path: '$.[''type'']'
        -
          uuid: 79675a8d02c2453a9cafbddd4cb5eeaa
          name: 'PVE API Resources - lxc'
          type: DEPENDENT
          key: pve.ct
          delay: '0'
          filter:
            conditions:
              -
                macro: '{#TYPE}'
                value: ^lxc$
                formulaid: A
              -
                macro: '{#VMID}'
                value: '{$PVE_IGNORE_ID}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
              -
                macro: '{#VMID}'
                value: '{$PVE_FORCE_ID}'
                formulaid: C
          description: 'Filter pve.cluster.resources and creates items, triggers and graphs'
          item_prototypes:
            -
              uuid: b1644ab351fb46dcaaa00cc30225a25c
              name: 'PVE Ct {#VMID} - {#NAME} cpu usage'
              type: DEPENDENT
              key: 'pve.ct.cpu[{#VMID}]'
              delay: '0'
              value_type: FLOAT
              units: '%'
              description: 'Container CPU Usage in %'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.cpu
                -
                  type: MULTIPLIER
                  parameters:
                    - '100'
              master_item:
                key: 'pve.ct[{#VMID}]'
              trigger_prototypes:
                -
                  uuid: c15a198e86904f738d98a3b49654c0b1
                  expression: 'last(/Proxmox VE by HTTP/pve.ct.cpu[{#VMID}])>80'
                  name: 'PVE Ct {#VMID} - {#NAME} high CPU usage'
                  priority: WARNING
                  description: 'Container CPU usage > 80%'
            -
              uuid: 0f475bc80ad84ff5a6c527e24e4876d4
              name: 'PVE Ct {#VMID} - {#NAME} disk usage'
              type: DEPENDENT
              key: 'pve.ct.disk[{#VMID}]'
              delay: '0'
              units: b
              description: 'Container disk usage in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.disk
              master_item:
                key: 'pve.ct[{#VMID}]'
            -
              uuid: e2067ed4b7344554a53644d8bed47d58
              name: 'PVE Ct {#VMID} - {#NAME} disk size'
              type: DEPENDENT
              key: 'pve.ct.maxdisk[{#VMID}]'
              delay: '0'
              units: b
              description: 'Container disk size in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.maxdisk
              master_item:
                key: 'pve.ct[{#VMID}]'
            -
              uuid: f4eb05006f2b42128594c604570cbb1b
              name: 'PVE Ct {#VMID} - {#NAME} memory size'
              type: DEPENDENT
              key: 'pve.ct.maxmem[{#VMID}]'
              delay: '0'
              units: b
              description: 'Container RAM size in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.maxmem
              master_item:
                key: 'pve.ct[{#VMID}]'
            -
              uuid: ac4c01f14be643a89f7bd0876bfc0781
              name: 'PVE Ct {#VMID} - {#NAME} swap size'
              type: DEPENDENT
              key: 'pve.ct.maxswap[{#VMID}]'
              delay: '0'
              units: b
              description: 'Container SWAP size in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.maxswap
              master_item:
                key: 'pve.ct[{#VMID}]'
            -
              uuid: 97a4d5ee8dff4077a686d41eacb9f678
              name: 'PVE Ct {#VMID} - {#NAME} memory usage'
              type: DEPENDENT
              key: 'pve.ct.mem[{#VMID}]'
              delay: '0'
              units: b
              description: 'Container RAM usage in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.mem
              master_item:
                key: 'pve.ct[{#VMID}]'
            -
              uuid: 9aa57f73ed5f4d86ac9c18fa0649f3f3
              name: 'PVE Ct {#VMID} - {#NAME} disk usage in %'
              type: CALCULATED
              key: 'pve.ct.pdisk[{#VMID}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//pve.ct.disk[{#VMID}])/last(//pve.ct.maxdisk[{#VMID}])'
              description: 'Container SWAP usage in %'
              trigger_prototypes:
                -
                  uuid: 50399f0eb27a4030bb38189c084a5a85
                  expression: 'last(/Proxmox VE by HTTP/pve.ct.pdisk[{#VMID}])>80'
                  name: 'PVE Ct {#VMID} - {#NAME} disk usage > 80%'
                  priority: WARNING
                  description: 'Container disk usage > 80%'
                  dependencies:
                    -
                      name: 'PVE Ct {#VMID} - {#NAME} disk usage > 90%'
                      expression: 'last(/Proxmox VE by HTTP/pve.ct.pdisk[{#VMID}])>90'
                -
                  uuid: d10412a2f0ab4175ae8671671dfb9414
                  expression: 'last(/Proxmox VE by HTTP/pve.ct.pdisk[{#VMID}])>90'
                  name: 'PVE Ct {#VMID} - {#NAME} disk usage > 90%'
                  priority: HIGH
                  description: 'Container disk usage > 90%'
            -
              uuid: 2790cb915ab145eb82d684ece2373cc7
              name: 'PVE Ct {#VMID} - {#NAME} memory usage in %'
              type: CALCULATED
              key: 'pve.ct.pmem[{#VMID}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//pve.ct.mem[{#VMID}])/last(//pve.ct.maxmem[{#VMID}])'
              description: 'Container RAM usage in %'
              trigger_prototypes:
                -
                  uuid: a1b65fcb91b3422086be01ca0e59156d
                  expression: 'last(/Proxmox VE by HTTP/pve.ct.pmem[{#VMID}])>80'
                  name: 'PVE Ct {#VMID} - {#NAME} RAM usage > 80%'
                  priority: WARNING
                  description: 'Container RAM usage > 80%'
                  dependencies:
                    -
                      name: 'PVE Ct {#VMID} - {#NAME} RAM usage > 90%'
                      expression: 'last(/Proxmox VE by HTTP/pve.ct.pmem[{#VMID}])>90'
                -
                  uuid: 2e1e70754e974fc493110f99cae3f9d4
                  expression: 'last(/Proxmox VE by HTTP/pve.ct.pmem[{#VMID}])>90'
                  name: 'PVE Ct {#VMID} - {#NAME} RAM usage > 90%'
                  priority: HIGH
                  description: 'Container RAM usage > 90%'
            -
              uuid: a02cc95eb9ea4f17825ca1f1ff29d1cd
              name: 'PVE Ct {#VMID} - {#NAME} swap usage in %'
              type: CALCULATED
              key: 'pve.ct.pswap[{#VMID}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//pve.ct.swap[{#VMID}])/last(//pve.ct.maxswap[{#VMID}])'
              description: 'Container SWAP usage in %'
              trigger_prototypes:
                -
                  uuid: 91084f9cfa2d451b8bd6915a6916a057
                  expression: 'last(/Proxmox VE by HTTP/pve.ct.pswap[{#VMID}])>80'
                  name: 'PVE Ct {#VMID} - {#NAME} SWAP usage > 80%'
                  priority: WARNING
                  description: 'Container SWAP usage > 80%'
                  dependencies:
                    -
                      name: 'PVE Ct {#VMID} - {#NAME} SWAP usage > 90%'
                      expression: 'last(/Proxmox VE by HTTP/pve.ct.pswap[{#VMID}])>90'
                -
                  uuid: 92c502b555894371bb2250928349369c
                  expression: 'last(/Proxmox VE by HTTP/pve.ct.pswap[{#VMID}])>90'
                  name: 'PVE Ct {#VMID} - {#NAME} SWAP usage > 90%'
                  priority: HIGH
                  description: 'Container SWAP usage > 90%'
            -
              uuid: 30db4c8cc4f1477cab79d071b32ab01c
              name: 'PVE Ct {#VMID} - {#NAME} status'
              type: DEPENDENT
              key: 'pve.ct.status[{#VMID}]'
              delay: '0'
              trends: '0'
              value_type: TEXT
              description: 'String, current container state'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.status
              master_item:
                key: 'pve.ct[{#VMID}]'
              trigger_prototypes:
                -
                  uuid: 91288d5b6e654070aab1138fcb102dfb
                  expression: 'find(/Proxmox VE by HTTP/pve.ct.status[{#VMID}],,,"running")=0'
                  name: 'PVE Ct {#VMID} - {#NAME} is not running'
                  priority: WARNING
                  description: 'Container state is not "running"'
            -
              uuid: 8530d975f8934a88ade1c5c01bfe8511
              name: 'PVE Ct {#VMID} - {#NAME} swap usage'
              type: DEPENDENT
              key: 'pve.ct.swap[{#VMID}]'
              delay: '0'
              units: b
              description: 'Container SWAP usage in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.swap
              master_item:
                key: 'pve.ct[{#VMID}]'
            -
              uuid: 0e58d46c3b7d4c969b187a22841541ff
              name: 'PVE Ct {#VMID} - {#NAME} uptime'
              type: DEPENDENT
              key: 'pve.ct.uptime[{#VMID}]'
              delay: '0'
              units: s
              description: 'Container uptime in seconds'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.uptime
              master_item:
                key: 'pve.ct[{#VMID}]'
              trigger_prototypes:
                -
                  uuid: eeaeb11a68d944bdb41498d086190765
                  expression: 'last(/Proxmox VE by HTTP/pve.ct.uptime[{#VMID}])<600'
                  name: 'PVE Ct {#VMID} - {#NAME} uptime < 10m'
                  priority: WARNING
                  description: 'Container uptime is < 600s'
                  dependencies:
                    -
                      name: 'PVE Ct {#VMID} - {#NAME} is not running'
                      expression: 'find(/Proxmox VE by HTTP/pve.ct.status[{#VMID}],,,"running")=0'
            -
              uuid: 6d8878433f5a4602aacd61fbc43eb14e
              name: 'PVE Ct {#VMID} - {#NAME}'
              type: HTTP_AGENT
              key: 'pve.ct[{#VMID}]'
              history: 1d
              trends: '0'
              value_type: TEXT
              description: 'JSON Response for `https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/lxc/{#VMID}/status/current` HTTP Query'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.data
              timeout: 10s
              url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/lxc/{#VMID}/status/current'
              headers:
                -
                  name: Authorization
                  value: 'PVEAPIToken={$PVE_API_TOKEN}'
          graph_prototypes:
            -
              uuid: 20d46c6dfe1f4b85aaf85f56fa9df271
              name: 'PVE Ct {#VMID} - {#NAME} CPU usage'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.ct.cpu[{#VMID}]'
            -
              uuid: 350fdbbf2ad042929e193a48b752d5d1
              name: 'PVE Ct {#VMID} - {#NAME} disk usage'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.ct.maxdisk[{#VMID}]'
                -
                  sortorder: '2'
                  drawtype: FILLED_REGION
                  color: F63100
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.ct.disk[{#VMID}]'
            -
              uuid: 0c32a59ec9094f07a4ef2f13c5d8b533
              name: 'PVE Ct {#VMID} - {#NAME} RAM usage'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.ct.maxmem[{#VMID}]'
                -
                  sortorder: '2'
                  drawtype: FILLED_REGION
                  color: F63100
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.ct.mem[{#VMID}]'
            -
              uuid: 8d2de0b2525b4c42865e57da3e0a73d3
              name: 'PVE Ct {#VMID} - {#NAME} SWAP usage'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.ct.maxswap[{#VMID}]'
                -
                  sortorder: '2'
                  drawtype: FILLED_REGION
                  color: F63100
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.ct.swap[{#VMID}]'
          host_prototypes:
            -
              uuid: 65cb8b301d78467ba1142b9e095672cb
              host: '{#NAME}'
              name: 'PVE Ct {#VMID} - {#NAME}'
              status: DISABLED
              discover: NO_DISCOVER
              group_links:
                -
                  group:
                    name: 'Discovered hosts'
              group_prototypes:
                -
                  name: '{#NODE} Containers'
          master_item:
            key: pve.cluster.resources
          lld_macro_paths:
            -
              lld_macro: '{#NAME}'
              path: '$.[''name'']'
            -
              lld_macro: '{#NODE}'
              path: '$.[''node'']'
            -
              lld_macro: '{#TYPE}'
              path: '$.[''type'']'
            -
              lld_macro: '{#VMID}'
              path: '$.[''vmid'']'
        -
          uuid: efb9aa937b1745a5b58535c8094bfb60
          name: 'PVE API Resources - node'
          type: DEPENDENT
          key: pve.nodes
          delay: '0'
          description: 'Filter pve.cluster.status and creates items, triggers and graphs'
          item_prototypes:
            -
              uuid: ab87ce129a5f43ac8ea14e2b370e8f84
              name: 'PVE Node {#NODE} CPU usage in %'
              type: DEPENDENT
              key: 'pve.nodes.cpu[{#NODE}]'
              delay: '0'
              value_type: FLOAT
              units: '%'
              description: 'Node CPU usage in %'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.cpu
                -
                  type: MULTIPLIER
                  parameters:
                    - '100'
              master_item:
                key: 'pve.nodes[{#NODE}]'
              trigger_prototypes:
                -
                  uuid: 7c8221b2263e4c3cbab6f67e1dc9c7a7
                  expression: 'last(/Proxmox VE by HTTP/pve.nodes.cpu[{#NODE}])>80'
                  name: 'PVE Node {#NODE} CPU usage > 80%'
                  priority: HIGH
                  description: 'Node CPU usage > 80%'
            -
              uuid: ebacb528631c44a8be1bc673d6ee210a
              name: 'PVE Node {#NODE} memory free'
              type: DEPENDENT
              key: 'pve.nodes.memory.free[{#NODE}]'
              delay: '0'
              units: b
              description: 'Free RAM in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.memory.free
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: 37773a19718f45f1b8aeee7046f06121
              name: 'PVE Node {#NODE} memory used in %'
              type: CALCULATED
              key: 'pve.nodes.memory.pused[{#NODE}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//pve.nodes.memory.used[{#NODE}])/last(//pve.nodes.memory.total[{#NODE}])'
              description: 'Used RAM in %'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '100'
              trigger_prototypes:
                -
                  uuid: ad58372005534b82b17b16b5c9a88814
                  expression: 'last(/Proxmox VE by HTTP/pve.nodes.memory.pused[{#NODE}])>80'
                  name: 'PVE Node {#NODE} memory usage > 80%'
                  priority: WARNING
                  description: 'Node RAM usage > 80%'
                  dependencies:
                    -
                      name: 'PVE Node {#NODE} memory usage > 90%'
                      expression: 'last(/Proxmox VE by HTTP/pve.nodes.memory.pused[{#NODE}])>90'
                -
                  uuid: ffc75ff4512342e88f33863a320128b8
                  expression: 'last(/Proxmox VE by HTTP/pve.nodes.memory.pused[{#NODE}])>90'
                  name: 'PVE Node {#NODE} memory usage > 90%'
                  priority: HIGH
                  description: 'Node RAM usage > 90%'
            -
              uuid: 9c05783b524a481f97333822f88dfcf8
              name: 'PVE Node {#NODE} memory size'
              type: DEPENDENT
              key: 'pve.nodes.memory.total[{#NODE}]'
              delay: '0'
              units: b
              description: 'Total RAM size in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.memory.total
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: 29de93ddc7d3471f891040586b842a74
              name: 'PVE Node {#NODE} memory used'
              type: DEPENDENT
              key: 'pve.nodes.memory.used[{#NODE}]'
              delay: '0'
              units: b
              description: 'Used RAM in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.memory.used
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: 3dfe850deaa845aea78d782ef2e5e315
              name: 'PVE Node {#NODE} pveversion'
              type: DEPENDENT
              key: 'pve.nodes.pveversion[{#NODE}]'
              delay: '0'
              trends: '0'
              value_type: TEXT
              description: 'PVE Version on node'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.pveversion
              master_item:
                key: 'pve.nodes[{#NODE}]'
              trigger_prototypes:
                -
                  uuid: 93f819244a234f4d8f0f60609d707fd7
                  expression: 'change(/Proxmox VE by HTTP/pve.nodes.pveversion[{#NODE}])>0'
                  name: 'PVE Node {#NODE} pve version changed'
                  priority: INFO
                  description: 'pveversion was changed since last check'
                  manual_close: 'YES'
            -
              uuid: 887c6dea4edb42b79934a20e37b8dbbe
              name: 'PVE Node {#NODE} rootfs available'
              type: DEPENDENT
              key: 'pve.nodes.rootfs.avail[{#NODE}]'
              delay: '0'
              units: b
              description: 'Available size in `/` in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.rootfs.avail
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: af68d89173924335adb0bc7196b83be2
              name: 'PVE Node {#NODE} rootfs free'
              type: DEPENDENT
              key: 'pve.nodes.rootfs.free[{#NODE}]'
              delay: '0'
              units: b
              description: 'Free size in `/` in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.rootfs.free
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: d48275f9e42d49f3ae4ee5b3f05bbdc8
              name: 'PVE Node {#NODE} rootfs used in %'
              type: CALCULATED
              key: 'pve.nodes.rootfs.pused[{#NODE}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//pve.nodes.rootfs.used[{#NODE}])/last(//pve.nodes.rootfs.total[{#NODE}])'
              description: 'Used size in `/` in %'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '100'
              trigger_prototypes:
                -
                  uuid: 93b19182b5284dde9e5ea11244995f41
                  expression: 'last(/Proxmox VE by HTTP/pve.nodes.rootfs.pused[{#NODE}])>80'
                  name: 'PVE Node {#NODE} rootfs usage > 80%'
                  priority: WARNING
                  description: 'Node rootfs usage > 80%'
                  dependencies:
                    -
                      name: 'PVE Node {#NODE} rootfs usage > 90%'
                      expression: 'last(/Proxmox VE by HTTP/pve.nodes.rootfs.pused[{#NODE}])>90'
                -
                  uuid: 9aaab1240cbb40e89f9f9a62d5899245
                  expression: 'last(/Proxmox VE by HTTP/pve.nodes.rootfs.pused[{#NODE}])>90'
                  name: 'PVE Node {#NODE} rootfs usage > 90%'
                  priority: HIGH
                  description: 'Node rootfs usage > 90%'
            -
              uuid: 66acbbb17e27484d8b95cb99271e9266
              name: 'PVE Node {#NODE} rootfs size'
              type: DEPENDENT
              key: 'pve.nodes.rootfs.total[{#NODE}]'
              delay: '0'
              units: b
              description: 'Total size in `/` in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.rootfs.total
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: adec78a34d3844d39f21936d28e72c42
              name: 'PVE Node {#NODE} rootfs used'
              type: DEPENDENT
              key: 'pve.nodes.rootfs.used[{#NODE}]'
              delay: '0'
              units: b
              description: 'Used size in `/` in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.rootfs.used
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: 42fe812ad87e4626a83688813ef4d32c
              name: 'PVE Node {#NODE} swap free'
              type: DEPENDENT
              key: 'pve.nodes.swap.free[{#NODE}]'
              delay: '0'
              units: b
              description: 'Free SWAP size in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.swap.free
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: f2e21b63e4af44ebb171fa1ff8ed231d
              name: 'PVE Node {#NODE} swap used in %'
              type: CALCULATED
              key: 'pve.nodes.swap.pused[{#NODE}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//pve.nodes.swap.used[{#NODE}])/last(//pve.nodes.swap.total[{#NODE}])'
              description: 'Used SWAP size in %'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '100'
              trigger_prototypes:
                -
                  uuid: 5540ec84ebd34c038b83a4615f9dcda9
                  expression: 'last(/Proxmox VE by HTTP/pve.nodes.swap.pused[{#NODE}])>80'
                  name: 'PVE Node {#NODE} swap usage > 80%'
                  priority: WARNING
                  description: 'Node SWAP usage > 80%'
                  dependencies:
                    -
                      name: 'PVE Node {#NODE} swap usage > 90%'
                      expression: 'last(/Proxmox VE by HTTP/pve.nodes.swap.pused[{#NODE}])>90'
                -
                  uuid: 75ca21735abd4b178faa1846c1cb3457
                  expression: 'last(/Proxmox VE by HTTP/pve.nodes.swap.pused[{#NODE}])>90'
                  name: 'PVE Node {#NODE} swap usage > 90%'
                  priority: HIGH
            -
              uuid: cd8ff86593124472901491e077969459
              name: 'PVE Node {#NODE} swap size'
              type: DEPENDENT
              key: 'pve.nodes.swap.total[{#NODE}]'
              delay: '0'
              units: b
              description: 'Total SWAP size in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.swap.total
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: e7c14a61616a47009c65cfcf3ee03fbc
              name: 'PVE Node {#NODE} swap used'
              type: DEPENDENT
              key: 'pve.nodes.swap.used[{#NODE}]'
              delay: '0'
              units: b
              description: 'Used SWAP size in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.swap.used
              master_item:
                key: 'pve.nodes[{#NODE}]'
            -
              uuid: eb7c74f87bb54d9e9db56df78763358f
              name: 'PVE Node {#NODE} updated packages'
              type: HTTP_AGENT
              key: 'pve.nodes.update[{#NODE}]'
              trends: '0'
              value_type: TEXT
              description: 'JSON Response for `https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/apt/update` HTTP Query'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.data
              timeout: 10s
              url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/apt/update'
              headers:
                -
                  name: Authorization
                  value: 'PVEAPIToken={$PVE_API_TOKEN}'
              trigger_prototypes:
                -
                  uuid: 8ec3d22f08ec4bf999d4e0567dc27ef7
                  expression: 'change(/Proxmox VE by HTTP/pve.nodes.update[{#NODE}])<>0 and find(/Proxmox VE by HTTP/pve.nodes.update[{#NODE}],,,"[]")<>1'
                  name: 'PVE Node {#NODE} has updates'
                  priority: INFO
                  description: 'PVE Node {#NODE} has updates'
            -
              uuid: 1b1c0014023d4f0ea4a84dfc2a9ea411
              name: 'PVE Node {#NODE} uptime'
              type: DEPENDENT
              key: 'pve.nodes.uptime[{#NODE}]'
              delay: '0'
              units: s
              description: 'Node uptime in seconds'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.uptime
              master_item:
                key: 'pve.nodes[{#NODE}]'
              trigger_prototypes:
                -
                  uuid: ee8bba82c10c4577a98b54b4e7b94026
                  expression: 'last(/Proxmox VE by HTTP/pve.nodes.uptime[{#NODE}])<600'
                  name: 'PVE Node {#NODE} uptime lesser than 10m'
                  priority: WARNING
                  description: 'Node has been restarted and node uptime is < 600s'
                  manual_close: 'YES'
            -
              uuid: 7d3677c5173c4a95b45a1de691f15edf
              name: 'PVE Node {#NODE} status'
              type: HTTP_AGENT
              key: 'pve.nodes[{#NODE}]'
              history: 1d
              trends: '0'
              value_type: TEXT
              description: 'JSON Response for `https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/status/` HTTP Query'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.data
              url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/status/'
              headers:
                -
                  name: Authorization
                  value: 'PVEAPIToken={$PVE_API_TOKEN}'
          graph_prototypes:
            -
              uuid: b1c9369c95be47908d71ea92aad59fc8
              name: 'PVE Node {#NODE} CPU'
              graph_items:
                -
                  sortorder: '1'
                  color: 2774A4
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.cpu[{#NODE}]'
            -
              uuid: ff9575608e4a44079f7443c20e7387a8
              name: 'PVE Node {#NODE} memory'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.memory.total[{#NODE}]'
                -
                  sortorder: '2'
                  drawtype: FILLED_REGION
                  color: F63100
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.memory.used[{#NODE}]'
            -
              uuid: 583d774e1d5c486085b4a7e46ac0d89b
              name: 'PVE Node {#NODE} rootfs'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.rootfs.total[{#NODE}]'
                -
                  sortorder: '2'
                  drawtype: FILLED_REGION
                  color: F63100
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.rootfs.used[{#NODE}]'
            -
              uuid: 52e555a97e1c4bfba6e54b468a62ecc3
              name: 'PVE Node {#NODE} swap'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.swap.total[{#NODE}]'
                -
                  sortorder: '2'
                  drawtype: FILLED_REGION
                  color: F63100
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.nodes.swap.used[{#NODE}]'
          master_item:
            key: pve.cluster.status
          lld_macro_paths:
            -
              lld_macro: '{#NODE}'
              path: '$.[''name'']'
            -
              lld_macro: '{#IP}'
              path: '$.[''ip'']'
            -
              lld_macro: '{#TYPE}'
              path: '$[''node'']'
        -
          uuid: 6d58027a895240a0b95759822b899949
          name: 'PVE API Resources - storage'
          type: DEPENDENT
          key: pve.storage
          delay: '0'
          filter:
            conditions:
              -
                macro: '{#TYPE}'
                value: ^storage$
                formulaid: C
              -
                macro: '{#NAME}'
                value: '{$PVE_IGNORE_STORAGE}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
              -
                macro: '{#NAME}'
                value: '{$PVE_FORCE_STORAGE}'
                formulaid: A
          description: 'Filter pve.cluster.resources and creates items, triggers and graphs'
          item_prototypes:
            -
              uuid: d50ea430c1134107b23aa67e2363fba0
              name: 'PVE Storage {#NODE} - {#NAME} active'
              type: DEPENDENT
              key: 'pve.storage.active[{#NODE}, {#NAME}]'
              delay: '0'
              description: 'Storage is active if value is 1'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.active
              master_item:
                key: 'pve.storage[{#NODE}, {#NAME}]'
            -
              uuid: 9b72f1264f934f0f897927327cb839e6
              name: 'PVE Storage {#NODE} - {#NAME} available'
              type: DEPENDENT
              key: 'pve.storage.available[{#NODE}, {#NAME}]'
              delay: '0'
              units: b
              description: 'Available size in storage in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.avail
              master_item:
                key: 'pve.storage[{#NODE}, {#NAME}]'
              trigger_prototypes:
                -
                  uuid: cd50fb14b6374ef4810b1f7df9d3ac04
                  expression: 'last(/Proxmox VE by HTTP/pve.storage.available[{#NODE}, {#NAME}])=0'
                  name: 'PVE Storage {#NODE} - {#NAME} unavailable'
                  priority: HIGH
            -
              uuid: 4b06b5380cf246a8b21697eca4d22acd
              name: 'PVE Storage {#NODE} - {#NAME} enabled'
              type: DEPENDENT
              key: 'pve.storage.enabled[{#NODE}, {#NAME}]'
              delay: '0'
              description: 'Storage is enabled if value is 1'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.enabled
              master_item:
                key: 'pve.storage[{#NODE}, {#NAME}]'
              trigger_prototypes:
                -
                  uuid: 79c2884dc3034c61ad183e0707651648
                  expression: 'last(/Proxmox VE by HTTP/pve.storage.enabled[{#NODE}, {#NAME}])=0'
                  name: 'PVE Storage {#NODE} - {#NAME} disabled'
                  priority: WARNING
                  description: 'Storage is disabled'
                  manual_close: 'YES'
            -
              uuid: c04a6ebd80d64fe59a8c205a724eaf70
              name: 'PVE Storage {#NODE} - {#NAME} used in %'
              type: CALCULATED
              key: 'pve.storage.pused[{#NODE}, {#NAME}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//pve.storage.used[{#NODE}, {#NAME}])/last(//pve.storage.total[{#NODE}, {#NAME}])'
              description: 'Used storage size in %'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '100'
              trigger_prototypes:
                -
                  uuid: 6a62cb31f3df4c07b2bb3aadb43fcf06
                  expression: 'last(/Proxmox VE by HTTP/pve.storage.pused[{#NODE}, {#NAME}])>80'
                  name: 'PVE Storage {#NODE} - {#NAME} used > 80 %'
                  priority: WARNING
                  description: 'Storage usage > 80%'
                  manual_close: 'YES'
                  dependencies:
                    -
                      name: 'PVE Storage {#NODE} - {#NAME} used > 90 %'
                      expression: 'last(/Proxmox VE by HTTP/pve.storage.pused[{#NODE}, {#NAME}])>90'
                -
                  uuid: abd45535c7304684b7e153fcf6e9bad6
                  expression: 'last(/Proxmox VE by HTTP/pve.storage.pused[{#NODE}, {#NAME}])>90'
                  name: 'PVE Storage {#NODE} - {#NAME} used > 90 %'
                  priority: HIGH
                  description: 'Storage usage > 80%'
                  manual_close: 'YES'
            -
              uuid: d900df10a9c64a2fb84efe98e9d5d6d1
              name: 'PVE Storage {#NODE} - {#NAME} size'
              type: DEPENDENT
              key: 'pve.storage.total[{#NODE}, {#NAME}]'
              delay: '0'
              units: b
              description: 'Total size of storage in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.total
              master_item:
                key: 'pve.storage[{#NODE}, {#NAME}]'
            -
              uuid: eab1a5de26ac41a5a921995ba13dc0cf
              name: 'PVE Storage {#NODE} - {#NAME} used'
              type: DEPENDENT
              key: 'pve.storage.used[{#NODE}, {#NAME}]'
              delay: '0'
              units: b
              description: 'Used storage size in bytes'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.used
              master_item:
                key: 'pve.storage[{#NODE}, {#NAME}]'
            -
              uuid: cf62650dfcc9437ea46453691f6e4cce
              name: 'PVE Storage {#NODE} - {#NAME}'
              type: HTTP_AGENT
              key: 'pve.storage[{#NODE}, {#NAME}]'
              history: 1d
              trends: '0'
              value_type: TEXT
              description: 'JSON Response for `https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/storage/{#NAME}/status` HTTP Query'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.data
              timeout: 10s
              url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/storage/{#NAME}/status'
              headers:
                -
                  name: Authorization
                  value: 'PVEAPIToken={$PVE_API_TOKEN}'
          graph_prototypes:
            -
              uuid: a456bad10ba149cfba855ceea74131eb
              name: 'PVE Storage {#NODE} - {#NAME} usage'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.storage.total[{#NODE}, {#NAME}]'
                -
                  sortorder: '2'
                  drawtype: FILLED_REGION
                  color: F63100
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.storage.used[{#NODE}, {#NAME}]'
          master_item:
            key: pve.cluster.resources
          lld_macro_paths:
            -
              lld_macro: '{#NAME}'
              path: '$.[''storage'']'
            -
              lld_macro: '{#NODE}'
              path: '$.[''node'']'
            -
              lld_macro: '{#TYPE}'
              path: '$.[''type'']'
        -
          uuid: 9d08d64e298340b08ec08bd694980421
          name: 'PVE API Resources - qemu'
          type: DEPENDENT
          key: pve.vm
          delay: '0'
          filter:
            conditions:
              -
                macro: '{#TYPE}'
                value: ^qemu$
                formulaid: A
              -
                macro: '{#VMID}'
                value: '{$PVE_IGNORE_ID}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
              -
                macro: '{#VMID}'
                value: '{$PVE_FORCE_ID}'
                formulaid: C
          description: 'Filter pve.cluster.resources and creates items, triggers and graphs'
          item_prototypes:
            -
              uuid: 004ca8fbe58e45d781e27262ea92f449
              name: 'PVE Vm {#VMID} - {#NAME} cpu usage'
              type: DEPENDENT
              key: 'pve.vm.cpu[{#VMID}]'
              delay: '0'
              value_type: FLOAT
              units: '%'
              description: 'VM CPU Usage in %'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.cpu
                -
                  type: MULTIPLIER
                  parameters:
                    - '100'
              master_item:
                key: 'pve.vm[{#VMID}]'
              trigger_prototypes:
                -
                  uuid: fd6b87ea220b4a828f01d5bf9c6cb617
                  expression: 'last(/Proxmox VE by HTTP/pve.vm.cpu[{#VMID}])>80'
                  name: 'PVE Vm {#VMID} - {#NAME} high CPU usage'
                  priority: WARNING
                  description: 'VM CPU usage > 80%'
            -
              uuid: 31aeb70e1522428bad9a30a512bd7eee
              name: 'PVE Vm {#VMID} - {#NAME} status'
              type: DEPENDENT
              key: 'pve.vm.status[{#VMID}]'
              delay: '0'
              trends: '0'
              value_type: TEXT
              description: 'String, current VM state'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.status
              master_item:
                key: 'pve.vm[{#VMID}]'
              trigger_prototypes:
                -
                  uuid: 3f3c7104e2bd4031b01ef0876d4a3b8b
                  expression: 'find(/Proxmox VE by HTTP/pve.vm.status[{#VMID}],,,"running")=0'
                  name: 'PVE Vm {#VMID} - {#NAME} is not running'
                  priority: WARNING
                  description: 'VM state is not "running"'
                  manual_close: 'YES'
            -
              uuid: a32890cceec246b78668057d4368d594
              name: 'PVE Vm {#VMID} - {#NAME} uptime'
              type: DEPENDENT
              key: 'pve.vm.uptime[{#VMID}]'
              delay: '0'
              units: s
              description: 'VM uptime in seconds'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.uptime
              master_item:
                key: 'pve.vm[{#VMID}]'
              trigger_prototypes:
                -
                  uuid: 938089eccf3a43ab87a42eed38ed507f
                  expression: 'last(/Proxmox VE by HTTP/pve.vm.uptime[{#VMID}])<600'
                  name: 'PVE Vm {#VMID} - {#NAME} uptime < 10m'
                  priority: WARNING
                  description: 'VM uptime is < 600s'
                  manual_close: 'YES'
                  dependencies:
                    -
                      name: 'PVE Vm {#VMID} - {#NAME} is not running'
                      expression: 'find(/Proxmox VE by HTTP/pve.vm.status[{#VMID}],,,"running")=0'
            -
              uuid: 9e8d7c7b4440438086876cfc9b94de9c
              name: 'PVE Vm {#VMID} - {#NAME}'
              type: HTTP_AGENT
              key: 'pve.vm[{#VMID}]'
              history: 1d
              trends: '0'
              value_type: TEXT
              description: 'JSON Response for `https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/qemu/{#VMID}/status/current` HTTP Query'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - $.data
              timeout: 10s
              url: 'https://{$PVE_API_HOST}:{$PVE_API_PORT}/api2/json/nodes/{#NODE}/qemu/{#VMID}/status/current'
              headers:
                -
                  name: Authorization
                  value: 'PVEAPIToken={$PVE_API_TOKEN}'
          graph_prototypes:
            -
              uuid: 2c3409a576c8455eb72e17bae1326268
              name: 'PVE Vm {#VMID} - {#NAME} CPU usage'
              graph_items:
                -
                  sortorder: '1'
                  color: 199C0D
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'pve.vm.cpu[{#VMID}]'
          host_prototypes:
            -
              uuid: 706ca1aa49be4d29a4b48baadcb36021
              host: '{#NAME}'
              name: 'PVE Vm {#VMID} - {#NAME}'
              status: DISABLED
              discover: NO_DISCOVER
              group_links:
                -
                  group:
                    name: 'Discovered hosts'
              group_prototypes:
                -
                  name: '{#NODE} Vms'
          master_item:
            key: pve.cluster.resources
          lld_macro_paths:
            -
              lld_macro: '{#NODE}'
              path: '$.[''node'']'
            -
              lld_macro: '{#TYPE}'
              path: '$.[''type'']'
            -
              lld_macro: '{#VMID}'
              path: '$.[''vmid'']'
            -
              lld_macro: '{#NAME}'
              path: '$.[''name'']'
      macros:
        -
          macro: '{$PVE_API_HOST}'
          value: '{HOST.NAME}'
          description: 'PVE web UI address. Default: {HOST.NAME}'
        -
          macro: '{$PVE_API_PORT}'
          value: '8006'
          description: 'PVE web UI Port. Default: 8006'
        -
          macro: '{$PVE_API_TOKEN}'
          type: SECRET_TEXT
          description: 'PVE API Token. Example: root@pam!monitoring=69ab8098-f2aa-455c-add3-e387aef0a47e'
        -
          macro: '{$PVE_FORCE_ID}'
          description: 'Force monitor VMs with this IDs. Regexp.'
        -
          macro: '{$PVE_FORCE_STORAGE}'
          description: 'Force monitor storages with this name. Regexp.'
        -
          macro: '{$PVE_IGNORE_ID}'
          description: 'Ignore VMs with this IDs. Regexp.'
        -
          macro: '{$PVE_IGNORE_STORAGE}'
          description: 'Ignore storages with this name. Regexp.'
  triggers:
    -
      uuid: 4ada30601119413a90e608bf2ce576c0
      expression: 'nodata(/Proxmox VE by HTTP/pve.cluster.resources,30m)<>0 and nodata(/Proxmox VE by HTTP/pve.cluster.status,30m)<>0 and nodata(/Proxmox VE by HTTP/pve.log,30m)<>0'
      name: 'PVE API - No data last 30m'
      priority: HIGH
      description: 'No data from API last 30 m'
    -
      uuid: a26c25c66d58451e913138f4de70fd05
      expression: 'change(/Proxmox VE by HTTP/pve.log.last.time)>0 and change(/Proxmox VE by HTTP/pve.log.last.message)<>0'
      recovery_mode: NONE
      name: 'PVE Log Warnings - New warning'
      priority: WARNING
      description: 'New warning in PVE Log (**only manual close**)'
      manual_close: 'YES'
